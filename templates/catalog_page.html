{% extends "default.html" %}

{% block content %}
<div class="container">
    <div class="d-flex">
        <div>
            {% autoescape false %}
            <h1 class="mt-5">{{data['title']}}</h1>
            <p class="lead">{{data['description']}}</p>
            {% endautoescape %}
            <form action="" method="post" novalidate enctype="multipart/form-data"
                  class="flex-column d-flex">
                <div>
                    {{ form.csrf_token }}
                </div>
                {% for field in form if field.name not in 'csrf_token submit' %}
                <div class="col-xs-4">
                    <label>{{ field.label() }}</label> <br/>
                    {{ field(class="form-control mb-4") }}
                    {% for error in field.errors %}
                    <div class="alert alert-danger">{{ error }}</div>
                    {% endfor %}
                </div>
                {% endfor %}
                <h5 class="text-warning">{{message}}</h5>
                {{ form.submit(type="submit", class="btn btn-warning") }}
            </form>
        </div>
        <img class="container w-25 me-0" src="{{ url_for('static', filename=data['icon'])}}">
    </div>
    <div class="mt-3">
        <h1 class="mt-5">Ваши обработки</h1>
        {% if processes|length > 0 %}
        <table class="table table-dark">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Дата</th>
                <th scope="col">Статус</th>
                <th scope="col">Результат</th>
            </tr>
            </thead>
            <tbody>
            {% for process in processes %}
            <tr>
                <th scope="row">{{process.id}}</th>
                <td>{{process.datetime.strftime('%d-%m-%Y %X')}}</td>

                {% if process.is_finished == 0 %}
                <td class="text-warning">В работе</td>
                <td></td>
                {% else %}
                {% if process.result_code == 200 %}
                <td class="text-success">Успешно</td>
                <td class="text-success">Готово</td>
                {% else %}
                <td class="text-danger">Ошибка</td>
                <td>{{process.result}}</td>
                {% endif %}
                {% endif %}
            </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
        <h5 class="text-muted">Запустите обработку и она появится тут!</h5>
        {% endif %}
    </div>

</div>
{% endblock %}